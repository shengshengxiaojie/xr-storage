{"version":3,"file":"b-storage.umd.js","sources":["../src/helps.ts","../src/Store.ts","../src/index.ts"],"sourcesContent":["// 字符化\nexport function serialize(val: any) {\n  return JSON.stringify(val)\n}\n\n// 反字符化\nexport function deserialize(val: string) {\n  try {\n    return JSON.parse(val)\n  } catch (e) {\n    return val || undefined\n  }\n}\n\n// 混合对象\nexport function extend<T, U>(to: T, from: U): T & U {\n  for (const key in from) {\n    ;(to as T & U)[key] = from[key] as any\n  }\n  return to as T & U\n}\n","import { StorageType, AllRes, StoreConfig } from './types'\nimport { serialize, deserialize } from './helps'\nclass Store {\n  storage: any\n  disabled: boolean = false\n\n  constructor(type: StorageType) {\n    try {\n      // 如果禁用了cookie，这里会捕获异常\n      let test = window.localStorage\n    } catch (e) {\n      this.disabled = true\n    }\n    this.storage = window[type]\n  }\n  do(config: StoreConfig): any {\n    if (this.disabled) return null\n    // this[config.method](config.key,config.value)\n    switch (config.method) {\n      case 'set':\n        return this.set(config.key, config.value)\n      case 'clear':\n        return this.clear()\n      case 'getAll':\n        return this.getAll()\n      case 'has':\n        return this.has(config.key)\n      case 'remove':\n        return this.remove(config.key)\n      default:\n        return this.get(config.key)\n    }\n  }\n  // 设置storage\n  set(key: string | undefined, value?: any): any {\n    if (!key || this.disabled) return null\n    if (value === undefined) {\n      this.remove(key)\n    }\n    this.storage.setItem(key, serialize(value))\n    return value\n  }\n  // 获取storage\n  get(key: string | undefined): any {\n    if (!key || this.disabled) return undefined\n    let val = deserialize(this.storage.getItem(key))\n    return val === undefined || val === null ? undefined : val\n  }\n\n  // 是否存在这个key\n  has(key: string | undefined): boolean {\n    if (!key || this.disabled) return false\n    return this.get(key) !== undefined\n  }\n\n  // 移除这个key\n  remove(key: string | undefined): void {\n    if (!key || this.disabled) return\n    this.storage.removeItem(key)\n  }\n  // 清除storage\n  clear(): void {\n    if (this.disabled) return\n    this.storage.clear()\n  }\n  // 获取所有的storage\n  getAll(): object {\n    if (this.disabled) return {}\n    let ret: AllRes\n    ret = {}\n    this.forEach((key: string, val: any) => {\n      ret[key] = val\n    })\n    return ret\n  }\n  // 遍历\n  forEach(callback: any) {\n    for (let i = 0; i < this.storage.length; i++) {\n      let key = this.storage.key(i)\n      callback(key, this.get(key))\n    }\n  }\n}\n\nexport default Store\n","import { StoreInstance, StorageType } from './types'\nimport { extend } from './helps'\nimport Store from './Store'\n\nfunction createInstance(type: StorageType = 'localStorage'): StoreInstance {\n  const context = new Store(type)\n  const instance = Store.prototype.do.bind(context)\n  extend(instance, context)\n  return instance as StoreInstance\n}\n\nconst store = createInstance()\nconst session = createInstance('sessionStorage')\n\nstore.session = session\n\nexport default store\n"],"names":[],"mappings":"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"}