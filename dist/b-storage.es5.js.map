{"version":3,"file":"b-storage.es5.js","sources":["../src/helps.ts","../src/Store.ts","../src/index.ts"],"sourcesContent":["// 字符化\nexport function serialize(val: any) {\n  return JSON.stringify(val)\n}\n\n// 反字符化\nexport function deserialize(val: string) {\n  try {\n    return JSON.parse(val)\n  } catch (e) {\n    return val || undefined\n  }\n}\n\n// 混合对象\nexport function extend<T, U>(to: T, from: U): T & U {\n  for (const key in from) {\n    ;(to as T & U)[key] = from[key] as any\n  }\n  return to as T & U\n}\n","import { StorageType, AllRes, StoreConfig } from './types'\nimport { serialize, deserialize } from './helps'\nclass Store {\n  storage: any\n  disabled: boolean = false\n\n  constructor(type: StorageType) {\n    try {\n      // 如果禁用了cookie，这里会捕获异常\n      let test = window.localStorage\n    } catch (e) {\n      this.disabled = true\n      return\n    }\n    this.storage = window[type]\n  }\n  do(config: StoreConfig): any {\n    if (this.disabled) return null\n    // this[config.method](config.key,config.value)\n    switch (config.method) {\n      case 'get':\n        return this.get(config.key)\n      case 'set':\n        return this.set(config.key, config.value)\n      case 'clear':\n        return this.clear()\n      case 'getAll':\n        return this.getAll()\n      case 'has':\n        return this.has(config.key)\n      case 'remove':\n        return this.has(config.key)\n      default:\n        this.get(config.key)\n    }\n  }\n  // 设置storage\n  set(key: string | undefined, value?: any): any {\n    if (!key || this.disabled) return null\n    if (value === undefined) {\n      this.remove(key)\n    }\n    this.storage.setItem(key, serialize(value))\n    return value\n  }\n  // 获取storage\n  get(key: string | undefined): any {\n    if (!key || this.disabled) return undefined\n    let val = deserialize(this.storage.getItem(key))\n    return val === undefined || val === null ? undefined : val\n  }\n\n  // 是否存在这个key\n  has(key: string | undefined): boolean {\n    if (!key || this.disabled) return false\n    return this.get(key) !== undefined\n  }\n\n  // 移除这个key\n  remove(key: string | undefined): void {\n    if (!key || this.disabled) return\n    this.storage.removeItem(key)\n  }\n  // 清除storage\n  clear(): void {\n    if (this.disabled) return\n    this.storage.clear()\n  }\n  // 获取所有的storage\n  getAll(): object {\n    if (this.disabled) return {}\n    let ret: AllRes\n    ret = {}\n    this.forEach((key: string, val: any) => {\n      ret[key] = val\n    })\n    return ret\n  }\n  // 遍历\n  forEach(callback: any) {\n    for (let i = 0; i < this.storage.length; i++) {\n      let key = this.storage.key(i)\n      callback(key, this.get(key))\n    }\n  }\n}\n\nexport default Store\n","import { StoreInstance, StorageType } from './types'\nimport { extend } from './helps'\nimport Store from './Store'\n\nfunction createInstance(type: StorageType = 'localStorage'): StoreInstance {\n  const context = new Store(type)\n  const instance = Store.prototype.do.bind(context)\n  extend(instance, context)\n  return instance as StoreInstance\n}\n\nconst store = createInstance()\nconst session = createInstance('sessionStorage')\n\nstore.session = session\n\nexport default store\n"],"names":[],"mappings":"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"}